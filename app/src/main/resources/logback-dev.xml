<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <!--
        Development environment configuration.
        - Logs to stdout (console)
        - JSON format with pretty printing
        - DEBUG level logging
        - Includes MDC for correlation IDs
    -->

    <!-- Application name for log context -->
    <variable name="APP_NAME" value="java-web-server" />

    <!-- ========================================== -->
    <!-- Console Appender (stdout) - JSON format   -->
    <!-- ========================================== -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="net.logstash.logback.encoder.LogstashEncoder">
            <!-- Add custom fields -->
            <customFields>{"app":"${APP_NAME}","env":"dev"}</customFields>

            <!-- Use ISO 8601 timestamp format -->
            <timestampPattern>yyyy-MM-dd'T'HH:mm:ss.SSSXXX</timestampPattern>

            <!-- Include MDC (Mapped Diagnostic Context) for correlation IDs -->
            <includeMdc>true</includeMdc>

            <!-- Include context name -->
            <includeContext>true</includeContext>

            <!-- Disable caller data for performance -->
            <includeCallerData>false</includeCallerData>

            <!-- Pretty print JSON for better readability in development -->
            <jsonGeneratorDecorator class="net.logstash.logback.decorate.PrettyPrintingJsonGeneratorDecorator"/>
        </encoder>
    </appender>

    <!-- ========================================== -->
    <!-- Root Logger: DEBUG level                  -->
    <!-- ========================================== -->
    <root level="DEBUG">
        <appender-ref ref="CONSOLE" />
    </root>

    <!-- ========================================== -->
    <!-- Logger configurations                     -->
    <!-- ========================================== -->

    <!-- Reduce noise from common libraries -->
    <logger name="org.eclipse.jetty" level="WARN"/>
    <logger name="io.netty" level="WARN"/>

    <!-- Application logger: DEBUG level -->
    <logger name="ch.alejandrogarciahub.webserver" level="DEBUG" additivity="false">
        <appender-ref ref="CONSOLE" />
    </logger>

</configuration>