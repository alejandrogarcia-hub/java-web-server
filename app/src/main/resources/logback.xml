<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <!--
        Default logback configuration (fallback).

        To use environment-specific configurations:
        - Development: Use logback-dev.xml (default if no system property set)
        - Production: Use logback-production.xml

        Set via: -Dlogback.configurationFile=logback-production.xml
        Or via ENV variable in code (see WebServer.java)
    -->

    <!-- Application name for log context -->
    <variable name="APP_NAME" value="java-web-server" />

    <!-- Console Appender (stdout) - JSON format -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="net.logstash.logback.encoder.LogstashEncoder">
            <customFields>{"app":"${APP_NAME}","env":"default"}</customFields>
            <timestampPattern>yyyy-MM-dd'T'HH:mm:ss.SSSXXX</timestampPattern>
            <includeMdc>true</includeMdc>
            <includeContext>true</includeContext>
            <includeCallerData>false</includeCallerData>
        </encoder>
    </appender>

    <!-- Default: Console, INFO level -->
    <root level="INFO">
        <appender-ref ref="CONSOLE" />
    </root>

    <!-- Reduce noise from common libraries -->
    <logger name="org.eclipse.jetty" level="WARN"/>
    <logger name="io.netty" level="WARN"/>

    <!-- Application logger -->
    <logger name="ch.alejandrogarciahub.webserver" level="INFO" additivity="false">
        <appender-ref ref="CONSOLE" />
    </logger>

</configuration>